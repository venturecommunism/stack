require(["lib/d3.min","Storage.min"],function(e,t){"use strict";function l(e,t){navigator.notification?navigator.notification.alert(e,null,t):alert(e)}function c(){var u=document.documentElement.clientWidth,l=document.documentElement.clientHeight;window.screen.width,window.screen.height;a=u,o=l-s,i=a/3,r=o/3,e.select("body").style("width",a+"px").style("height",o+"px").style("margin","0").style("padding","0")}function f(n){var r=e.select("img#bingo");r.empty()&&(r=e.select("body").append("img").attr("id","bingo")),r.attr("src",n),r.attr("class","allow-download");var i=e.range(1,10).map(function(e){return t.get("box"+e+"name")}).filter(function(e){return e}),a="Just about to start my %23chi2016 %23bingo!";if(i.length>0){var o=i.reduce(function(e,t,n,r){var i=", ";return n===r.length-1&&(i=" and "),e?e.concat(i).concat(t):t}),u=i.length>1?" are ":" is ";a=o+u+"in my %23chi2016 %23bingo"}a="https://twitter.com/intent/tweet?text="+a.replace(" ","%20");var s=e.select("a#message");s.attr("href",a)}function h(t){function u(t){var o=t.map(function(e,t,n){return e.image?{width:i,height:e.image.height*i/e.image.width}:{width:0,height:0}}),u=o.reduce(function(e,t,n,r){var i=e[e.length-1];return i.length<3?i.push(t):e.push([t]),e},[[]]);console.log(JSON.stringify(u));var s=u.map(function(t){return e.max(t.map(function(e){return e.height}))||r}),l=i;n.width=3*l,n.height=s[0]+s[1]+s[2],a.fillStyle="white",a.fillRect(0,0,n.width,n.height),t.forEach(function(e,t){var r=t%3,i=Math.floor(t/3),u=r*l,c=s.slice(0,i).reduce(function(e,t){return e+t},0);e.image?a.drawImage(e.image,u,c,l,o[t].height):(a.save(),a.textAlign="center",a.fillStyle="white",a.fillRect(u,c,o[t].width,o[t].height),a.fillStyle="black",a.fillText(e.name||"?",u+l/2,c+s[i]/2,l),a.restore()),8===t&&f(n.toDataURL())})}function s(e){return new Promise(function(t,n){var r=new Image;e.image?(r.onload=function(){t({name:e.name,image:r})},r.onerror=function(e){n(e)},r.src=e.image):t({name:e.name})})}var n=document.createElement("canvas"),a=n.getContext("2d");Promise.all(t.map(function(e){return s(e)})).then(function(e){u(e)},function(e){l(JSON.stringify(e),"Error")})}function g(){var n=e.range(1,10).map(function(e){var n="box"+e+"image",r="box"+e+"name";return{name:t.get(r),image:t.get(n)}});return n}var r,i,a,o,s=40;c(),h(g())});