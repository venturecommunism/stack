!function(){function e(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");return i.drawImage(e,-t+1,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function t(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);for(var a=i.getImageData(0,0,1,n).data,o=0,u=n,s=n;s>o;){var l=a[4*(s-1)+3];0===l?u=s:o=s,s=u+o>>1}var f=s/n;return 0===f?1:f}function n(e,t,n){var i=document.createElement("canvas");return r(e,i,t,n),i.toDataURL("image/jpeg",t.quality||.8)}function r(n,r,a,o){var u=n.naturalWidth,s=n.naturalHeight,l=a.width,f=a.height,c=r.getContext("2d");c.save(),i(r,c,l,f,a.orientation);var h=e(n);h&&(u/=2,s/=2);var d=1024,p=document.createElement("canvas");p.width=p.height=d;for(var g=p.getContext("2d"),m=o?t(n,u,s):1,v=Math.ceil(d*l/u),y=Math.ceil(d*f/s/m),x=0,w=0;s>x;){for(var b=0,M=0;u>b;)g.clearRect(0,0,d,d),g.drawImage(n,-b,-x),c.drawImage(p,0,0,d,d,M,w,v,y),b+=d,M+=v;x+=d,w+=y}c.restore(),p=g=null}function i(e,t,n,r,i){switch(i){case 5:case 6:case 7:case 8:e.width=r,e.height=n;break;default:e.width=n,e.height=r}switch(i){case 2:t.translate(n,0),t.scale(-1,1);break;case 3:t.translate(n,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(n,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-n,0)}}function a(e){if(window.Blob&&e instanceof Blob){var t=new Image,n=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!n)throw Error("No createObjectURL function found to create blob url");t.src=n.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,n=e.length;n>t;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}a.prototype.render=function(e,t){if(this.imageLoadListeners){var i=this;return void this.imageLoadListeners.push(function(){i.render(e,t)})}t=t||{};var a=this.srcImage.naturalWidth,o=this.srcImage.naturalHeight,u=t.width,s=t.height,l=t.maxWidth,f=t.maxHeight,c=!this.blob||"image/jpeg"===this.blob.type;u&&!s?s=o*u/a<<0:s&&!u?u=a*s/o<<0:(u=a,s=o),l&&u>l&&(u=l,s=o*u/a<<0),f&&s>f&&(s=f,u=a*s/o<<0);var h={width:u,height:s};for(var d in t)h[d]=t[d];var p=e.tagName.toLowerCase();"img"===p?e.src=n(this.srcImage,h,c):"canvas"===p&&r(this.srcImage,e,h,c),"function"==typeof this.onrender&&this.onrender(e)},"function"==typeof define&&define.amd?define([],function(){return a}):this.MegaPixImage=a}();